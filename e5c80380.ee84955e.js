(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{101:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var i=n(0),l=n.n(i);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,i,l=function(e,t){if(null==e)return{};var n,i,l={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=l.a.createContext({}),u=function(e){var t=l.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=u(e.components);return l.a.createElement(s.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return l.a.createElement(l.a.Fragment,{},t)}},p=l.a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),d=u(n),p=i,m=d["".concat(o,".").concat(p)]||d[p]||b[p]||a;return n?l.a.createElement(m,r(r({ref:t},s),{},{components:n})):l.a.createElement(m,r({ref:t},s))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=p;var r={};for(var c in t)hasOwnProperty.call(t,c)&&(r[c]=t[c]);r.originalType=e,r.mdxType="string"==typeof e?e:i,o[1]=r;for(var s=2;s<a;s++)o[s]=n[s];return l.a.createElement.apply(null,o)}return l.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},93:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return r})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return u}));var i=n(2),l=n(6),a=(n(0),n(101)),o={id:"fun-with-ienumerable-and-collection-initializers",title:"Fun with IEnumerable and collection initializers",author:"Jaco Jansen van Vuuren",author_title:"Software Developer",author_url:"https://github.com/jacojvv-dev",author_image_url:"https://avatars0.githubusercontent.com/u/14131955?v=4",tags:["c#","csharp","ienumerable"],image:"https://www.jacojvv.dev/img/covers/2020-10-04-fun-with-ienumerable-and-collection-initializers.png"},r={permalink:"/blog/fun-with-ienumerable-and-collection-initializers",editUrl:"https://github.com/jacojvv-dev/jacojvv.dev/edit/main/blog/2020-10-04-fun-with-ienumerable-and-collection-initializers.md",source:"@site/blog\\2020-10-04-fun-with-ienumerable-and-collection-initializers.md",description:"IEnumerable and collection initializers. You probably use them every day (if you write C# code at least) without thinking about the implementation details too much. And honestly - neither did I. But after I got a null reference exception (by accident, of course) whilst doing an assignment to a collection I was reminded about some of the interesting parts of IEnumerable - and some of the fun stuff you can do with it.",date:"2020-10-04T00:00:00.000Z",tags:[{label:"c#",permalink:"/blog/tags/c"},{label:"csharp",permalink:"/blog/tags/csharp"},{label:"ienumerable",permalink:"/blog/tags/ienumerable"}],title:"Fun with IEnumerable and collection initializers",readingTime:3.7,truncated:!0,prevItem:{title:"Building LINQ expressions",permalink:"/blog/building-linq-expressions"},nextItem:{title:"Customizing configuration sources for Azure Functions",permalink:"/blog/customizing-configuration-sources-for-azure-functions"}},c=[{value:"Collection initializers?",id:"collection-initializers",children:[]},{value:"A look under the hood",id:"a-look-under-the-hood",children:[]},{value:"Different ways to initialize collections on creation",id:"different-ways-to-initialize-collections-on-creation",children:[]},{value:"So how does the C# compiler know which classes support collection initializers?",id:"so-how-does-the-c-compiler-know-which-classes-support-collection-initializers",children:[]},{value:"Abusing IEnumerable and collection initializers to build an addition calculator",id:"abusing-ienumerable-and-collection-initializers-to-build-an-addition-calculator",children:[]}],s={rightToc:c};function u(e){var t=e.components,n=Object(l.a)(e,["components"]);return Object(a.b)("wrapper",Object(i.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"IEnumerable and collection initializers. You probably use them every day (if you write C# code at least) without thinking about the implementation details too much. And honestly - neither did I. But after I got a null reference exception (by accident, of course) whilst doing an assignment to a collection I was reminded about some of the interesting parts of IEnumerable - and some of the fun stuff you can do with it."),Object(a.b)("h3",{id:"collection-initializers"},"Collection initializers?"),Object(a.b)("p",null,"Put very simply, collection initializers allow you to turn this:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-csharp"}),'// No collection initializer\nvar values = new List<string>();\nvalues.Add("value1");\nvalues.Add("value2");\nvalues.Add("value3");\n')),Object(a.b)("p",null,"Into this:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-csharp"}),'// Using a collection initializer\nvar values = new List<string> {"value1", "value2", "value3"};\n')),Object(a.b)("p",null,"As you can see - the version using the collection initializer is a lot cleaner."),Object(a.b)("h3",{id:"a-look-under-the-hood"},"A look under the hood"),Object(a.b)("p",null,"Let's take a look at the IL that is generated by the C# compiler for the following initializer by running it through dotPeek."),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cs"}),'var values = new List<string> {"value1", "value2", "value3"};\n')),Object(a.b)("p",null,"The (shortened by me) IL is below - take a look too see if you can see what is happening."),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{}),'IL_0001: newobj       instance void class [System.Collections]System.Collections.Generic.List`1<string>::.ctor()\nIL_0007: ldstr        "value1"\nIL_000c: callvirt     instance void class [System.Collections]System.Collections.Generic.List`1<string>::Add(!0/*string*/)\nIL_0013: ldstr        "value2"\nIL_0018: callvirt     instance void class [System.Collections]System.Collections.Generic.List`1<string>::Add(!0/*string*/)\nIL_001f: ldstr        "value3"\nIL_0024: callvirt     instance void class [System.Collections]System.Collections.Generic.List`1<string>::Add(!0/*string*/)\n')),Object(a.b)("p",null,'If you spotted what I wanted you to see you would have noticed that the C# compiler calls the ".Add" method for every string specified in the brackets. That means that the initializer is equivalent to mutliple calls to ".Add".'),Object(a.b)("p",null,'Below is the IL for the the same method - but using ".Add" instead of the collection initializer:'),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{}),'IL_0001: newobj       instance void class [System.Collections]System.Collections.Generic.List`1<string>::.ctor()\nIL_0008: ldstr        "value1"\nIL_000d: callvirt     instance void class [System.Collections]System.Collections.Generic.List`1<string>::Add(!0/*string*/)\nIL_0014: ldstr        "value2"\nIL_0019: callvirt     instance void class [System.Collections]System.Collections.Generic.List`1<string>::Add(!0/*string*/)\nIL_0020: ldstr        "value3"\nIL_0025: callvirt     instance void class [System.Collections]System.Collections.Generic.List`1<string>::Add(!0/*string*/)\n')),Object(a.b)("h3",{id:"different-ways-to-initialize-collections-on-creation"},"Different ways to initialize collections on creation"),Object(a.b)("p",null,"Consider the following class:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cs"}),"public class SomeClass\n{\n    public List<string> Values { get; set; }\n}\n")),Object(a.b)("p",null,"Using initializers - you can create a new instance of it like this:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cs"}),'var someObject = new SomeClass()\n{\n    Values = new List<string> { "value1", "value2", "value3" }\n};\n')),Object(a.b)("p",null,"You can also do the following (note the missing new) - but be careful - you will get a runtime NullReferenceException if the list is not instantiated:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cs"}),'var someObject = new SomeClass()\n{\n    Values = { "value1", "value2", "value3" }\n};\n')),Object(a.b)("p",null,"To avoid the NullReferenceException you can set a default value for Values in SomeClass. This could also be useful if you always want a value in the list:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cs"}),"public class SomeClass\n{\n    public List<string> Values { get; set; } = new List<string>();\n}\n")),Object(a.b)("h3",{id:"so-how-does-the-c-compiler-know-which-classes-support-collection-initializers"},"So how does the C# compiler know which classes support collection initializers?"),Object(a.b)("p",null,"Basically - it checks that the class implements IEnumerable. If it does - it can be used with a collection initializer."),Object(a.b)("h3",{id:"abusing-ienumerable-and-collection-initializers-to-build-an-addition-calculator"},"Abusing IEnumerable and collection initializers to build an addition calculator"),Object(a.b)("p",null,"Before we dive into this - I have to warn you. Don't do something like this in production."),Object(a.b)("p",null,"Consider the following class:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cs"}),"public class Adder\n{\n    public int Result { get; private set; } = 0;\n\n    public void Add(int addend)\n    {\n        Result += addend;\n    }\n}\n")),Object(a.b)("p",null,"We can use it as follows:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cs"}),"var adder = new Adder();\nadder.Add(1);\nadder.Add(1);\nadder.Add(1);\nadder.Add(1);\n\nConsole.WriteLine(adder.Result); // 4\n")),Object(a.b)("p",null,"But what would happen if we implemented IEnumerable on it and used a collection initializer? Would that work?"),Object(a.b)("p",null,"Here is the same class - but implementing IEnumerable:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cs"}),"public class Adder : IEnumerable\n{\n    public int Result { get; private set; } = 0;\n\n    public void Add(int addend)\n    {\n        Result += addend;\n    }\n\n    public IEnumerator GetEnumerator()\n    {\n        throw new NotImplementedException();\n    }\n}\n")),Object(a.b)("p",null,'Usage - note the use of the collection initializer. The C# compiler will automatically insert all the calls to ".Add" in the IL:'),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-cs"}),"var adder = new Adder { 1, 1, 1, 1 };\n\nConsole.WriteLine(calculator.Result); // 4\n")),Object(a.b)("p",null,'As you can see - by implementing IEnumerable on our class we can "force" the compiler to allow us to use collection initializers instead of typing ".Add" several times.'),Object(a.b)("p",null,"If you are interested in learning more about collection initializers in C# - I would highly recommend reading ",Object(a.b)("a",Object(i.a)({parentName:"p"},{href:"https://csharpindepth.com/"}),"C# In Depth")," which covers initializers and many other topics in great detail."))}u.isMDXComponent=!0}}]);